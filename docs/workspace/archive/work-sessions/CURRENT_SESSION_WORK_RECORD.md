# ä½œæ¥­è¨˜éŒ² - éšå±¤å‹ã‚¿ãƒ–ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆ

## å®Ÿæ–½æ—¥æ™‚ãƒ»ä½œæ¥­æ¦‚è¦
- **é–‹å§‹**: 2025å¹´1æœˆ21æ—¥
- **ç›®çš„**: éšå±¤å‹ã‚¿ãƒ–ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆå®Ÿæ–½
- **ä½œæ¥­å†…å®¹**: CURRENT_SESSION_DESIGN.mdã«åŸºã¥ãçµ±åˆãƒ†ã‚¹ãƒˆ

## æ™‚ç³»åˆ—ä½œæ¥­è¨˜éŒ²

### 1. åˆæœŸçŠ¶æ…‹ç¢ºèªãƒ»ç’°å¢ƒæº–å‚™ (å®Œäº†)
**æ™‚åˆ»**: é–‹å§‹æ™‚
**ä½œæ¥­å†…å®¹**:
- å®Ÿè£…æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
  - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: `src/aetherterm/agentserver/models/session.py`
  - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: `src/aetherterm/agentserver/services/session_manager.py`
  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: `frontend/src/types/session.ts`
  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: `frontend/src/stores/sessionStore.ts`
  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: `frontend/src/services/SessionSocketService.ts`
  - Vueã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: `SessionManager.vue`, `TerminalPaneManager.vue`, `SessionCommunication.vue`
  - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: `circus.ini`
**çµæœ**: å…¨ã¦ã®å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰PiniaåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ä¿®æ­£ (å®Œäº†)
**æ™‚åˆ»**: ç¢ºèªä½œæ¥­å¾Œ
**å•é¡Œ**: 
```
Uncaught Error: [ğŸ]: "getActivePinia()" was called but there was no active Pinia.
```
**åŸå› **: `SessionSocketService.ts`ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§Pinia store ã‚’å³åº§ã«åˆæœŸåŒ–
**è§£æ±ºç­–**: lazy initialization ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…
```typescript
// Before
constructor() {
  this.sessionStore = useSessionStore()
}

// After  
constructor() {
  // Initialize store lazily to avoid Pinia initialization issues
}

private get sessionStore() {
  if (!this._sessionStore) {
    this._sessionStore = useSessionStore()
  }
  return this._sessionStore
}
```
**çµæœ**: PiniaåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ã‚’è§£æ±º

### 3. STARTUP.mdæ›´æ–° (å®Œäº†)
**æ™‚åˆ»**: ã‚¨ãƒ©ãƒ¼ä¿®æ­£å¾Œ
**ä½œæ¥­å†…å®¹**:
- é–‹ç™ºç’°å¢ƒå°‚ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ˜ç¢ºåŒ–
- Circus ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã‚’æ¨å¥¨æ–¹æ³•ã¨ã—ã¦å‰é¢ã«é…ç½®
- éæ¨å¥¨ã®å€‹åˆ¥èµ·å‹•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
- æœ¬ç•ªç’°å¢ƒè¨˜è¿°ã‚’çµ±åˆãƒ†ã‚¹ãƒˆè¨˜è¿°ã«å¤‰æ›´
**çµæœ**: é–‹ç™ºç’°å¢ƒèµ·å‹•æ‰‹é †ãŒæ˜ç¢ºåŒ–ã•ã‚Œã€circusä½¿ç”¨ãŒæ¨å¥¨ã•ã‚Œã‚‹æ§‹æˆ

### 4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ (å®Œäº†)
**æ™‚åˆ»**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°å¾Œ
**ã‚³ãƒãƒ³ãƒ‰**: `make build-frontend`
**å‡¦ç†å†…å®¹**:
- `pnpm install` - ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- `pnpm run build` - Viteç”Ÿç”£ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ
- `vue-tsc --build` - TypeScriptå‹ãƒã‚§ãƒƒã‚¯
- é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’AgentServerã«é…å¸ƒ
**çµæœ**: 
- ãƒ“ãƒ«ãƒ‰æˆåŠŸ (1,344.20 kB main bundle)
- é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ãŒ `src/aetherterm/agentserver/static/` ã«é…å¸ƒå®Œäº†
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒ `src/aetherterm/agentserver/templates/index.html` ã«é…ç½®å®Œäº†

### 5. Circus ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã‚µãƒ¼ãƒãƒ¼èµ·å‹• (å®Œäº†)
**æ™‚åˆ»**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰å¾Œ
**æ‰‹é †**:
1. `mkdir -p logs` - ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
2. `circusd circus.ini --daemon` - Circusãƒ‡ãƒ¼ãƒ¢ãƒ³èµ·å‹•
**ç¢ºèªçµæœ**:
```bash
$ circusctl status
agentserver: active
circusd-stats: active  
frontend: active
```
**ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª**:
- AgentServer (http://localhost:57575): HTTP 200 âœ“
- Frontend Dev Server (http://localhost:5173): HTTP 200 âœ“

### 6. ãƒ­ã‚°ç¢ºèªãƒ»èµ·å‹•çŠ¶æ…‹æ¤œè¨¼ (å®Œäº†)
**æ™‚åˆ»**: ã‚µãƒ¼ãƒãƒ¼èµ·å‹•å¾Œ
**AgentServerãƒ­ã‚°**: æ­£å¸¸èµ·å‹•ç¢ºèªã€ä¸€éƒ¨LangChainãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å¤‰æ›´æ¤œå‡ºè­¦å‘Š (æ­£å¸¸)
**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ­ã‚°**: ã‚¨ãƒ©ãƒ¼ãªã—
**çµæœ**: ä¸¡ã‚µãƒ¼ãƒ“ã‚¹ãŒæ­£å¸¸ã«ç¨¼åƒä¸­

## ç¾åœ¨çŠ¶æ³
- **å…¨é«˜å„ªå…ˆåº¦ã‚¿ã‚¹ã‚¯å®Œäº†**: âœ…
- **ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒçŠ¶æ…‹**: AgentServer + Frontend Dev Server ä¸¡æ–¹ç¨¼åƒä¸­
- **æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æ©Ÿèƒ½ã®å®Ÿå‹•ä½œãƒ†ã‚¹ãƒˆ

## æ¬¡å›ãƒ†ã‚¹ãƒˆé …ç›® (æœªå®Ÿæ–½)
1. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆãƒ»ç®¡ç†æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ**
   - ãƒ–ãƒ©ã‚¦ã‚¶ã§http://localhost:57575ã‚¢ã‚¯ã‚»ã‚¹
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆUIå‹•ä½œç¢ºèª
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³å‚åŠ æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
   
2. **tmuxé¢¨ãƒšãƒ¼ãƒ³åˆ†å‰²ãƒ†ã‚¹ãƒˆ**
   - Ctrl+B % (æ°´å¹³åˆ†å‰²)
   - Ctrl+B " (å‚ç›´åˆ†å‰²)
   - ãƒšãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆãƒ»å‰Šé™¤

3. **ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“é€šä¿¡ãƒ†ã‚¹ãƒˆ**
   - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ©Ÿèƒ½
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…ä¿¡ç¢ºèª

## æŠ€è¡“çš„èª²é¡Œãƒ»æ‡¸æ¡ˆ
- **Socket.IOãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç™»éŒ²**: ä¸€éƒ¨ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ãŒæœªå®Ÿè£… (`wrapper_session_sync`, `get_wrapper_sessions`, `unblock_request`, `get_block_status`)
- **æ¨©é™ç®¡ç†**: å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚·ã‚¹ãƒ†ãƒ é€£æºãŒæœªå®Ÿè£… (TODO ã‚³ãƒ¡ãƒ³ãƒˆå¤šæ•°)
- **æ°¸ç¶šåŒ–**: Redis/Databaseçµ±åˆãŒæœªå®Ÿè£…

## é–‹ç™ºç’°å¢ƒè¨­å®š (ç¢ºç«‹æ¸ˆã¿)
- **æ¨å¥¨èµ·å‹•æ–¹æ³•**: `circusd circus.ini`
- **ãƒ­ã‚°ç›£è¦–**: `tail -f logs/*.log`
- **ã‚µãƒ¼ãƒ“ã‚¹åˆ¶å¾¡**: `circusctl start/stop/restart [service]`
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆãƒ†ã‚¹ãƒˆ**: `make build-frontend`

---
**çŠ¶æ…‹**: å®Ÿè£…ãƒ»ç’°å¢ƒæ§‹ç¯‰ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†ã€æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹æº–å‚™å®Œäº†